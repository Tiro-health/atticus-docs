export const metadata = {
  title: 'Web SDK',
  description:
    'Integrate Tiro.health form filling capabilities into any web application using native Web Components.',
}

export const sections = [
  { title: 'Installation', id: 'installation' },
  { title: 'Quick Start', id: 'quick-start' },
  { title: 'Components', id: 'components' },
  { title: 'Events', id: 'events' },
  { title: 'Framework Integration', id: 'framework-integration' },
]

# Web SDK

The Tiro.health Web SDK provides native Web Components for integrating FHIR-based form filling capabilities into any web application. {{ className: 'lead' }}

The SDK is built with **native Web Components** that work with any JavaScript framework or vanilla JavaScript:

- **`<tiro-form-filler>`**: Interactive form rendering with full SDC support
- **`<tiro-narrative>`**: Clinical narrative generation from responses
- **`<tiro-validation-report>`**: Real-time validation error display

---

## Installation

### NPM (Recommended)

```bash
npm install @tiro-health/web-sdk
```

Import the SDK and its stylesheet:

```javascript
import '@tiro-health/web-sdk'
import '@tiro-health/web-sdk/style.css'
```

<Note>
  **CSS is required.** The Web Components will not render correctly without the stylesheet.
</Note>

### CDN

For applications without build tools:

```html
<link rel="stylesheet" href="https://cdn.tiro.health/sdk/latest/tiro-web-sdk.css">
<script src="https://cdn.tiro.health/sdk/latest/tiro-web-sdk.iife.js"></script>
```

### Bundle Options

| Bundle | Import | Use When |
|--------|--------|----------|
| **Full** | `@tiro-health/web-sdk` | Your app doesn't use React |
| **Lite** | `@tiro-health/web-sdk/lite` | Your app already has React 18 |

---

## Quick Start

```html
<tiro-form-filler
  id="my-form"
  questionnaire="http://templates.tiro.health/example|1.0.0"
  sdc-endpoint-address="https://sdc.tiro.health/fhir/r5">
</tiro-form-filler>

<script>
  document.getElementById('my-form')
    .addEventListener('tiro-submit', (e) => {
      console.log('Submitted:', e.detail.response)
    })
</script>
```

### With Narrative and Validation

Components link together using the `for` attribute:

```html
<tiro-form-filler
  id="patient-form"
  questionnaire="http://templates.tiro.health/patient-intake|2.0.0"
  sdc-endpoint-address="https://sdc.tiro.health/fhir/r5">
</tiro-form-filler>

<tiro-narrative for="patient-form"></tiro-narrative>
<tiro-validation-report for="patient-form"></tiro-validation-report>
```

---

## Components

### `<tiro-form-filler>`

The primary component for rendering FHIR Questionnaires.

**Attributes:**
- `questionnaire` - Canonical URL with version (e.g., `url|version`)
- `sdc-endpoint-address` - SDC FHIR server URL
- `launch-context` - JSON object with FHIR resources (Patient, Encounter)
- `read-only` - Disable form editing

**Methods:**
- `getResponse()` - Get current QuestionnaireResponse
- `submit()` - Programmatically submit the form
- `checkValidity()` - Check if form is valid

### `<tiro-narrative>`

Generates human-readable clinical narratives from questionnaire responses.

```html
<tiro-narrative for="my-form"></tiro-narrative>
```

### `<tiro-validation-report>`

Displays FHIR OperationOutcome validation results. Automatically hides when valid.

```html
<tiro-validation-report for="my-form"></tiro-validation-report>
```

---

## Events

All components emit custom DOM events with the `tiro-` prefix:

```javascript
const form = document.getElementById('my-form')

form.addEventListener('tiro-update', (e) => {
  console.log('Response:', e.detail.response)
})

form.addEventListener('tiro-submit', (e) => {
  console.log('Submitted:', e.detail.response)
})

form.addEventListener('tiro-validate', (e) => {
  console.log('Valid:', e.detail.isValid)
})

form.addEventListener('tiro-error', (e) => {
  console.error('Error:', e.detail.error)
})

form.addEventListener('tiro-ready', (e) => {
  console.log('Loaded:', e.detail.questionnaire)
})
```

---

## Framework Integration

Web Components work with any framework using standard DOM APIs.

### React

```jsx
import '@tiro-health/web-sdk'
import '@tiro-health/web-sdk/style.css'
import { useRef, useEffect } from 'react'

function FormPage() {
  const formRef = useRef(null)

  useEffect(() => {
    const form = formRef.current
    const handleSubmit = (e) => console.log(e.detail.response)
    form.addEventListener('tiro-submit', handleSubmit)
    return () => form.removeEventListener('tiro-submit', handleSubmit)
  }, [])

  return (
    <tiro-form-filler
      ref={formRef}
      questionnaire="http://example.com/q|1.0.0"
      sdc-endpoint-address="https://sdc.example.com/fhir/r5"
    />
  )
}
```

### Angular

Add `CUSTOM_ELEMENTS_SCHEMA` to your module or component:

```typescript
import { CUSTOM_ELEMENTS_SCHEMA, Component } from '@angular/core'
import '@tiro-health/web-sdk'
import '@tiro-health/web-sdk/style.css'

@Component({
  selector: 'app-form',
  schemas: [CUSTOM_ELEMENTS_SCHEMA],
  template: `
    <tiro-form-filler
      [attr.questionnaire]="questionnaire"
      [attr.sdc-endpoint-address]="sdcEndpoint"
      (tiro-submit)="onSubmit($event)">
    </tiro-form-filler>
  `
})
export class FormComponent {
  questionnaire = 'http://example.com/q|1.0.0'
  sdcEndpoint = 'https://sdc.example.com/fhir/r5'

  onSubmit(event: CustomEvent) {
    console.log(event.detail.response)
  }
}
```

### Vanilla JavaScript

```javascript
import '@tiro-health/web-sdk'
import '@tiro-health/web-sdk/style.css'

const form = document.createElement('tiro-form-filler')
form.setAttribute('questionnaire', 'http://example.com/q|1.0.0')
form.setAttribute('sdc-endpoint-address', 'https://sdc.example.com/fhir/r5')
form.addEventListener('tiro-submit', (e) => console.log(e.detail.response))
document.body.appendChild(form)
```

---

For detailed API reference, see the [npm package documentation](https://www.npmjs.com/package/@tiro-health/web-sdk).
