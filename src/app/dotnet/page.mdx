export const metadata = {
  title: '.NET',
  description:
    'This page focuses on the UI integration in .NET applications.',
}

# Intergrating Attcius in a .NET frontend

Atticus can be integrated in .NET that use Windows Forms, WPF, or UWP. This page focuses on the UI integration in .NET applications. The technology used for this
integration is WebView2, a browser control that renders web applications in .NET applications.

## Prerequisites

Before you start integrating Atticus in your .NET application, make sure you have the following prerequisites:

- [Visual Studio](https://visualstudio.microsoft.com/)
- [.NET 5.0 or later](https://dotnet.microsoft.com/download/dotnet/)
- [WebView2 SDK](https://developer.microsoft.com/en-us/microsoft-edge/webview2/)

## Set up the WebView2 control

To get started with integrating Atticus in your .NET application, follow these steps:

1. Create a new .NET Windows Forms application in Visual Studio.

2. Add the necessary NuGet packages to your project:
   - Microsoft.Web.WebView2
   - Newtonsoft.Json

3. Add the webview control to your form in the designer:

  - Drag a WebView2 control from the toolbox to your form. [See the Microsoft docs for more information](https://learn.microsoft.com/en-us/microsoft-edge/webview2/get-started/winforms#step-5---create-a-single-webview2-control)
  - Initialize the WebView2 control in the form constructor:
    ```csharp
    public Form1()
    {
        InitializeComponent();
        InitializeWebView2Async();

        async void InitializeAsync()
        {
            await webView.EnsureCoreWebView2Async(null);
            await createSession();
        }

        async Task createSession()
        {
            // Here comes the code to create a session
        }
    }
    ```
## Create an authenticated session

To create an authenticated session, you need to include the client credentials in your request and send a POST request along with session specific data. Here's what to do:

1. Create a dictionary with the required session data:
    ```csharp
    var postData = new Dictionary<string, string>
    {
        { "patient", patientId }, // FHIR Patient.id
        { "encounter", encounterId } // FHIR Encounter.id (optional)
    };
    ```

2. Build a POST request with the necessary headers:
    ```csharp
    var postDataStream = new MemoryStream(Encoding.UTF8.GetBytes(JsonConvert.SerializeObject(postData)));
    var request = webView.CoreWebView2.Environment.CreateWebResourceRequest(
        "https://auth.tiro.health/session",
        "POST",
        postDataStream,
        null);

    // Add authentication header
    string clientId = Environment.GetEnvironmentVariable("CLIENT_ID");
    string clientSecret = Environment.GetEnvironmentVariable("CLIENT_SECRET");
    var authToken = Encoding.ASCII.GetBytes($"{clientId}:{clientSecret}");
    var authHeader = $"Basic {Convert.ToBase64String(authToken)}";
    request.Headers.SetHeader("Authorization", authHeader);

    // Add content type header
    request.Headers.SetHeader("Content-Type", "application/json");

    // Add user identification header
    request.Headers.SetHeader("x-user-id", userIdentifier);
    ```

3. Send the request and handle the response:
    ```csharp
    webView.CoreWebView2.NavigateWithWebResourceRequest(request);
    webView.CoreWebView2.NavigationCompleted += (sender, args) =>
    {
        if (args.IsSuccess)
        {
            // Navigate to the Atticus Filler UI
            webView.CoreWebView2.Navigate("https://atticus.tiro.health/filler/123");
        }
    };
    ```

## Receive realtime updates

_to be completed_
